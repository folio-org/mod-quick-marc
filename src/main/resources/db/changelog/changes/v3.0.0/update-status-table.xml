<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.5.xsd">

    <changeSet id="MODQM-223@@rename-record-creation-status-table" author="psmahin">
        <preConditions>
            <tableExists tableName="record_creation_status"/>
        </preConditions>
        <renameTable oldTableName="record_creation_status" newTableName="action_status"/>
    </changeSet>

    <changeSet id="MODQM-223@@cleanup-action-status-table" author="psmahin">
        <preConditions>
            <tableExists tableName="action_status"/>
        </preConditions>
        <delete tableName="action_status"/>
    </changeSet>

    <changeSet id="MODQM-223@@add-job-profile-id-column" author="psmahin">
        <addColumn tableName="action_status">
            <column name="job_profile_id" type="UUID">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="MODQM-223@@add-job-profile-id-column-fk" author="psmahin">
        <addForeignKeyConstraint baseTableName="action_status"
                                 baseColumnNames="job_profile_id"
                                 referencedTableName="job_profile"
                                 referencedColumnNames="id"
                                 deleteCascade="true"
                                 constraintName="fk_action_status_job_profile_id"/>
    </changeSet>
    <changeSet id="MODQM-223@@raname-status-created-to-completed" author="Pavlo_Smahin">
        <sql>
            ALTER TYPE status RENAME VALUE 'CREATED' TO 'COMPLETED';
        </sql>
    </changeSet>


</databaseChangeLog>
